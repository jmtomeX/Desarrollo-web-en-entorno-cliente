<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="../jquery-3.4.1.js"></script>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <link
      href="https://fonts.googleapis.com/css?family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Bebas Neue", cursive;
      }
      #main {
        width: 100%;
        display: flex;
        justify-content: center;
      }

      input,
      select {
        width: 200px;
        height: 30px;
        border-radius: 5px;
        border: 1px solid black;
      }
      input[type="button"] {
        background: white;
      }
      input[type="button"]:hover {
        background: black;
        color: white;
      }
    </style>
    <title>Document</title>
  </head>

  <body>
    <main id="main">
      <section id="content">
        <div id="pedidos"></div>
        <h2>Tipo de gráfica</h2>
        <select name="grafica" id="grafica">
          <option value="PieChart">Gráfica de sectores</option>
          <option value="ColumnChart">Gráfica de barras</option>
        </select>
        <input type="button" value="Mostrar Gráfica" id="cambiar" />
        <div id="piechart" style="width: 900px; height: 500px;"></div>
      </section>
    </main>
    <script>
      $(function() {
        var total_sobremesa = 0;
        var total_portatiles = 0;
        var total_tablets = 0;
        var cont = 0;
        var cont_mostrar = 0;
        var pedidos = new Array();
        pedidos[cont] = new Array();
        pedidos[0] = new Array(3);
        $.get("pedidos.xml", function(xml) {
          $(xml)
            .find("productos")
            .each(function() {
              var fecha = $(this).attr("fecha");

              var sobremesa = $(this)
                .find("sobremesa")
                .text();
              var cantidadPC = $(this)
                .find("sobremesa")
                .attr("cantidad");

              var portatil = $(this)
                .find("portatil")
                .text();
              var cantidadp = $(this)
                .find("portatil")
                .attr("cantidad");

              var tablet = $(this)
                .find("tablet")
                .text();
              var cantidadt = $(this)
                .find("tablet")
                .attr("cantidad");

              pedidos[cont] = [fecha, cantidadPC, cantidadp, cantidadt];
              cont++;

              // [sobremesa, portatil, tablet];
              for (
                cont_mostrar;
                cont_mostrar < pedidos.length;
                cont_mostrar++
              ) {
                for (var j = 0; j < 4; j++) {
                  if (pedidos[cont_mostrar][j] == undefined) {
                    pedidos[cont_mostrar][j] = 0;
                  }
                }
                total_sobremesa += parseInt(pedidos[cont_mostrar][1]);
                total_portatiles += parseInt(pedidos[cont_mostrar][2]);
                total_tablets += parseInt(pedidos[cont_mostrar][3]);
                $("#pedidos").append(
                  "<h2>Fecha : " +
                    pedidos[cont_mostrar][0] +
                    " se han vendido " +
                    pedidos[cont_mostrar][1] +
                    "  sobremesas, " +
                    pedidos[cont_mostrar][2] +
                    " portatiles " +
                    pedidos[cont_mostrar][3] +
                    " tablets.</h2>"
                );
              }
            });
        });
        $("#cambiar").click(function() {
          var tipo_grafica = $("select[name=grafica]").val();
          var chart =
            "new google.visualization." +
            tipo_grafica +
            '(document.getElementById("piechart"))';
          localStorage.setItem("grafica", chart);
          location.reload(true);
        });
        google.charts.load("current", {
          packages: ["corechart"]
        });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
          var data = google.visualization.arrayToDataTable([
            [
              "Electrónica",
              "Ventas",
              {
                role: "style"
              }
            ],
            ["Sobremesa", total_sobremesa, "yellow"],
            ["Portatiles", total_portatiles, "silver"],
            ["Tablets", total_tablets, "red"]
          ]);
          var options = {
            title: "Actividad en tienda",
            is3D: true
          };

          var grafica = localStorage.getItem("grafica");
          chart = eval(grafica);
          chart.draw(data, options);
        }
      });
    </script>
    <!-- 
CREA UN XML CON TRES PEDIDOS
En cada pedido se pueden vender estos productos: Sobremesas, Portátiles y Tablets, de los cuales se indicará la cantidad vendida en cada pedido,
todos los pedidos tendrán una fecha.
Un ejemplo de pedido sería que el día 4/12/2019 se ha pedido 4 sobremesas y 2 tablets.
Comprueba que quede bien formado y luego crea un DTD que lo valide.
Por último muestra los datos de los pedidos en pantalla de los pedidos en pantalla en líneas o filas.
Y por último representa los datos de sobremesas, portátil y tablets vendidos en total con un gráfico.
Poder elegir el tipo de gráfico
-->
  </body>
</html>

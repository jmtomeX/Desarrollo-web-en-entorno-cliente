<!DOCTYPE html>
<div lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Alquiler de aulas</title>
        <script src="./js/moment.js"></script>

        <style>
            body {
                box-sizing: border-box;
                font-family: Georgia, 'Times New Roman', Times, serif;
            }
            
            #container {
                background-color: #fafafa;
                margin: 1rem;
                padding: 1rem;
                border: 2px solid #ccc;
                /* IMPORTANTE */
                text-align: justify;
            }
            
            input[type="time"],
            label {
                margin: 1em;
            }
            
            th {
                padding: 1em;
            }
            
            #reloj {
                font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
                font-size: 2em;
            }
        </style>
        <script>
            var momentoActual = "";

            function mueveReloj() {

                momentoActual = new Date();
                var hora = momentoActual.getHours();
                var minuto = momentoActual.getMinutes();
                var segundo = momentoActual.getSeconds();
                horaImprimible = hora + " : " + minuto + " : " + segundo;
                document.getElementById("reloj").innerHTML = horaImprimible;
                setTimeout("mueveReloj()", 1000);
            }

            /*
            Primero: si reservan menos de una hora que se les cobre la hora entera, y si por ejemplo reserva algo mas de una hora ...
           
            Tercero: Poner dia y hora
            */

            function calcular() {
                var hour_in = form1.hora_entrada.value;
                var hour_out = form1.hora_salida.value;

                hour_in = moment(hour_in, 'HH:mm');
                hour_out = moment(hour_out, 'HH:mm');
                var minutos_totales = hour_out.diff(hour_in, 'minutes');

                //Sacar la difencia de minutos
                var resto_minutos = minutos_totales % 60;
                console.log(minutos_totales + " resto minutos " + resto_minutos);
                console.log("Minutos totales " + minutos_totales);
                var horas_totales = hour_out.diff(hour_in, 'hours');
                console.log("----- *" + horas_totales)
                    //minutos_totales = Math.abs(minutos_totales);
                if (minutos_totales % 60 != 0) {
                    horas_totales += 1;
                }

                // Comprobar que la hora de entrada no puede ser menor
                if (hour_in >= hour_out) {
                    alert("La hora de entrada no puede ser menor a la de salida.");
                    return;
                }

                //  Segundo: un aviso diciendo las horas que faltan para iniciar a la reserva.
                /********************************************************************************/
                //var hora_actual = moment().format('LTS');
                //console.log(hora_actual);
                var hora_actual = moment(momentoActual, 'HH:mm');
                if (hour_in < hora_actual) {
                    alert("La hora de entrada es anterior a la hora actual.");
                    return;
                }
                console.log("Hora actual ----> " + momentoActual);

                //var resta = moment(hora).endOf(hour_in).fromNow(); // en 8 horas

                var horas_acceso = hour_in.diff(hora_actual, 'hours');
                alert("Falta " + horas_acceso + " para acceder al aula.");
                console.log(horas_acceso);

                /************************************************************************************/
                //hour_prue = moment.duration(24, "minutes").humanize();
                var precio = 0;
                if (form1.hora.value == "aula1") {
                    precio = parseInt(document.getElementById("price1").innerHTML);
                } else {
                    precio = parseInt(document.getElementById("price2").innerHTML);
                }
                // Calculamos el precio
                var precio_total = parseInt(horas_totales * precio);

                alert("El precio total es " + precio_total);
                alert("Has cogido el aula " + horas_totales + " y " + resto_minutos + "minutos");
                //var reloj = setTimeout("moment().format('LTS')", 1000)
            }
        </script>
    </head>

    <body onload="mueveReloj()">
        <div id="container">
            <form id="form1">
                <table width="400" border="1">
                    <tr>
                        <td colspan="2" align="center" id="reloj"></td>
                    </tr>
                    <tr>
                        <th scope="col">
                            <input type="radio" name="hora" value="aula1" checked/>
                            <label for="radio">Aula 1</label></p>
                            <img src="./aula1.JPG" width="500" height="400" alt="">
                            <h3><span id="price1">8</span>€</h3>
                        </th>
                        <th scope="col">
                            <input type="radio" name="hora" value="aula2" />
                            <label for="radio">Aula 2</label></p>
                            <img src="./aula2.jpg" width="500" height="400" alt="">
                            <h3><span id="price2">10</span>€</h3>
                        </th>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label for="hora_entrada">Hora de entrada</label><input type="time" name="hora_entrada" min="09:00" max="22:00" value="10:00">
                            <label for="hora_salida">Hora de salida</label><input type="time" name="hora_salida" min="10:00" max="22:00" value="13:00">
                            <input type="button" onclick="calcular()" value="Coger Aula"></input>
                        </td>

                    </tr>
                </table>
            </form>
        </div>
    </body>

</div>